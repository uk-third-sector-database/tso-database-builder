import pytest

import io

from .geo_lookup import postcode_dict

def test_pc_dict_nspl():

    data = '''pcd,pcd2,pcds,dointr,doterm,usertype,oseast1m,osnrth1m,osgrdind,oa21,cty,ced,laua,ward,nhser,ctry,rgn,pcon,ttwa,itl,npark,lsoa21,msoa21,wz11,sicbl,bua22,ru11ind,oac11,lat,long,lep1,lep2,pfa,imd,icb
"AB1 0AA","AB1  0AA","AB1 0AA","198001","199606","0","385386","0801193","1","S00090303","S99999999","S99999999","S12000033","S13002843","S99999999","S92000003","S99999999","S14000002","S22000047","S30000026","S99999999","S01006514","S02001237","S34002990","S03000012","S99999999","3","1C3",57.101474,-2.242851,"S99999999","","S23000009",6715,"S99999999"
"AB1 0AB","AB1  0AB","AB1 0AB","198001","199606","0","385177","0801314","1","S00090303","S99999999","S99999999","S12000033","S13002843","S99999999","S92000003","S99999999","S14000002","S22000047","S30000026","S99999999","S01006514","S02001237","S34002990","S03000012","S99999999","3","1C3",57.102554,-2.246308,"S99999999","","S23000009",6715,"S99999999"
"AB1 0AD","AB1  0AD","AB1 0AD","198001","199606","0","385053","0801092","1","S00090399","S99999999","S99999999","S12000033","S13002843","S99999999","S92000003","S99999999","S14000002","S22000047","S30000026","S99999999","S01006514","S02001237","S34003015","S03000012","S99999999","3","6A1",57.100556,-2.248342,"S99999999","","S23000009",6715,"S99999999"
"AB1 0AE","AB1  0AE","AB1 0AE","199402","199606","0","384600","0799300","8","S00091322","S99999999","S99999999","S12000034","S13002864","S99999999","S92000003","S99999999","S14000058","S22000047","S30000027","S99999999","S01006853","S02001296","S34003292","S03000013","S99999999","6","1A2",57.084444,-2.255708,"S99999999","","S23000009",5069,"S99999999"'''

    f1 = io.StringIO(data)


    fields = ['pcd','lat','long']



    d = {'FIELDS':fields,
"AB1 0AA" : ["AB1 0AA",'57.101474','-2.242851'],
"AB1 0AB" : ["AB1 0AB",'57.102554','-2.246308'],
"AB1 0AD" : ["AB1 0AD",'57.100556','-2.248342'],
"AB1 0AE" : ["AB1 0AE",'57.084444','-2.255708']}

    assert postcode_dict(f1,'pcd',fields) == d


def test_using_pc_dict():
    data = '''pcd,pcd2,pcds,dointr,doterm,usertype,oseast1m,osnrth1m,osgrdind,oa21,cty,ced,laua,ward,nhser,ctry,rgn,pcon,ttwa,itl,npark,lsoa21,msoa21,wz11,sicbl,bua22,ru11ind,oac11,lat,long,lep1,lep2,pfa,imd,icb
"AB1 0AA","AB1  0AA","AB1 0AA","198001","199606","0","385386","0801193","1","S00090303","S99999999","S99999999","S12000033","S13002843","S99999999","S92000003","S99999999","S14000002","S22000047","S30000026","S99999999","S01006514","S02001237","S34002990","S03000012","S99999999","3","1C3",57.101474,-2.242851,"S99999999","","S23000009",6715,"S99999999"
"AB1 0AB","AB1  0AB","AB1 0AB","198001","199606","0","385177","0801314","1","S00090303","S99999999","S99999999","S12000033","S13002843","S99999999","S92000003","S99999999","S14000002","S22000047","S30000026","S99999999","S01006514","S02001237","S34002990","S03000012","S99999999","3","1C3",57.102554,-2.246308,"S99999999","","S23000009",6715,"S99999999"
"AB1 0AD","AB1  0AD","AB1 0AD","198001","199606","0","385053","0801092","1","S00090399","S99999999","S99999999","S12000033","S13002843","S99999999","S92000003","S99999999","S14000002","S22000047","S30000026","S99999999","S01006514","S02001237","S34003015","S03000012","S99999999","3","6A1",57.100556,-2.248342,"S99999999","","S23000009",6715,"S99999999"
"AB1 0AE","AB1  0AE","AB1 0AE","199402","199606","0","384600","0799300","8","S00091322","S99999999","S99999999","S12000034","S13002864","S99999999","S92000003","S99999999","S14000058","S22000047","S30000027","S99999999","S01006853","S02001296","S34003292","S03000013","S99999999","6","1A2",57.084444,-2.255708,"S99999999","","S23000009",5069,"S99999999"'''

    f1 = io.StringIO(data)

    fields = ['pcd','lat','long']


    d = postcode_dict(f1,'pcd',fields)


    pc ='AB1 0AA'
    d1 = dict(zip(fields,d[pc]))
    assert d1['lat'] == '57.101474'

    pc = 'AB1 0AB'
    d1 = dict(zip(fields,d[pc]))
    assert d1['long'] == '-2.246308'